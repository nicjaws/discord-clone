{"version":3,"file":"chakra-ui-autocomplete.cjs.production.min.js","sources":["../src/index.tsx"],"sourcesContent":["/* eslint-disable prettier/prettier */\nimport * as React from 'react'\nimport {\n  useCombobox,\n  useMultipleSelection,\n  UseMultipleSelectionProps\n} from 'downshift'\nimport matchSorter from 'match-sorter'\nimport Highlighter from 'react-highlight-words'\nimport useDeepCompareEffect from 'react-use/lib/useDeepCompareEffect'\nimport { FormLabel, FormLabelProps } from '@chakra-ui/form-control'\nimport { Text, Stack, Box, BoxProps, List, ListItem, ListIcon } from '@chakra-ui/layout'\nimport { Button, ButtonProps } from '@chakra-ui/button'\nimport { Input, InputProps } from '@chakra-ui/input'\nimport { IconProps, CheckCircleIcon } from '@chakra-ui/icons'\nimport { Tag, TagCloseButton, TagLabel, TagProps } from '@chakra-ui/tag'\nimport { ComponentWithAs } from '@chakra-ui/react'\n\nexport interface Item {\n  label: string\n  value: string\n}\n\nexport interface CUIAutoCompleteProps<T extends Item>\n  extends UseMultipleSelectionProps<T> {\n  items: T[]\n  placeholder: string\n  label: string\n  highlightItemBg?: string\n  onCreateItem?: (item: T) => void\n  optionFilterFunc?: (items: T[], inputValue: string) => T[]\n  itemRenderer?: (item: T) => string | JSX.Element\n  labelStyleProps?: FormLabelProps\n  inputStyleProps?: InputProps\n  toggleButtonStyleProps?: ButtonProps\n  tagStyleProps?: TagProps\n  listStyleProps?: BoxProps\n  listItemStyleProps?: BoxProps\n  emptyState?: (inputValue: string) => React.ReactNode\n  selectedIconProps?: Omit<IconProps, 'name'> & {\n    icon: IconProps['name'] | React.ComponentType\n  }\n  icon?: ComponentWithAs<\"svg\", IconProps>;\n}\n\nfunction defaultOptionFilterFunc<T>(items: T[], inputValue: string) {\n  return matchSorter(items, inputValue, { keys: ['value', 'label'] })\n}\n\nexport const CUIAutoComplete = <T extends Item>(\n  props: CUIAutoCompleteProps<T>\n): React.ReactElement<CUIAutoCompleteProps<T>> => {\n  const {\n    items,\n    optionFilterFunc = defaultOptionFilterFunc,\n    itemRenderer,\n    highlightItemBg = 'gray.100',\n    placeholder,\n    label,\n    listStyleProps,\n    labelStyleProps,\n    inputStyleProps,\n    toggleButtonStyleProps,\n    tagStyleProps,\n    selectedIconProps,\n    listItemStyleProps,\n    onCreateItem,\n    icon,\n    ...downshiftProps\n  } = props\n\n  /* States */\n  const [isCreating, setIsCreating] = React.useState(false)\n  const [inputValue, setInputValue] = React.useState('')\n  const [inputItems, setInputItems] = React.useState<T[]>(items)\n\n  /* Refs */\n  const disclosureRef = React.useRef(null)\n\n  /* Downshift Props */\n  const {\n    getSelectedItemProps,\n    getDropdownProps,\n    addSelectedItem,\n    removeSelectedItem,\n    selectedItems\n  } = useMultipleSelection(downshiftProps)\n  const selectedItemValues = selectedItems.map((item) => item.value)\n\n  const {\n    isOpen,\n    getToggleButtonProps,\n    getLabelProps,\n    getMenuProps,\n    getInputProps,\n    getComboboxProps,\n    highlightedIndex,\n    getItemProps,\n    openMenu,\n    selectItem,\n    setHighlightedIndex\n  } = useCombobox({\n    inputValue,\n    selectedItem: undefined,\n    items: inputItems,\n    onInputValueChange: ({ inputValue, selectedItem }) => {\n      const filteredItems = optionFilterFunc(items, inputValue || '')\n\n      if (isCreating && filteredItems.length > 0) {\n        setIsCreating(false)\n      }\n\n      if (!selectedItem) {\n        setInputItems(filteredItems)\n      }\n    },\n    stateReducer: (state, actionAndChanges) => {\n      const { changes, type } = actionAndChanges\n      switch (type) {\n        case useCombobox.stateChangeTypes.InputBlur:\n          return {\n            ...changes,\n            isOpen: false\n          }\n        case useCombobox.stateChangeTypes.InputKeyDownEnter:\n        case useCombobox.stateChangeTypes.ItemClick:\n          return {\n            ...changes,\n            highlightedIndex: state.highlightedIndex,\n            inputValue,\n            isOpen: true\n          }\n        case useCombobox.stateChangeTypes.FunctionSelectItem:\n          return {\n            ...changes,\n            inputValue\n          }\n        default:\n          return changes\n      }\n    },\n    // @ts-ignore\n    onStateChange: ({ inputValue, type, selectedItem }) => {\n      switch (type) {\n        case useCombobox.stateChangeTypes.InputChange:\n          setInputValue(inputValue || '')\n          break\n        case useCombobox.stateChangeTypes.InputKeyDownEnter:\n        case useCombobox.stateChangeTypes.ItemClick:\n          if (selectedItem) {\n            if (selectedItemValues.includes(selectedItem.value)) {\n              removeSelectedItem(selectedItem)\n            } else {\n              if (onCreateItem && isCreating) {\n                onCreateItem(selectedItem)\n                setIsCreating(false)\n                setInputItems(items)\n                setInputValue('')\n              } else {\n                addSelectedItem(selectedItem)\n              }\n            }\n\n            // @ts-ignore\n            selectItem(null)\n          }\n          break\n        default:\n          break\n      }\n    }\n  })\n\n  React.useEffect(() => {\n    if (inputItems.length === 0) {\n      setIsCreating(true)\n      // @ts-ignore\n      setInputItems([{ label: `${inputValue}`, value: inputValue }])\n      setHighlightedIndex(0)\n    }\n  }, [inputItems, setIsCreating, setHighlightedIndex, inputValue])\n\n  useDeepCompareEffect(() => {\n    setInputItems(items)\n  }, [items])\n\n  /* Default Items Renderer */\n  function defaultItemRenderer<T extends Item>(selected: T) {\n    return selected.label\n  }\n\n  return (\n    <Stack>\n      <FormLabel {...getLabelProps({})}>{label}</FormLabel>\n\n      {/* ---------Stack with Selected Menu Tags above the Input Box--------- */}\n      {selectedItems && (\n        <Stack spacing={2} isInline flexWrap='wrap'>\n          {selectedItems.map((selectedItem, index) => (\n            <Tag\n              mb={1}\n              {...tagStyleProps}\n              key={`selected-item-${index}`}\n              {...getSelectedItemProps({ selectedItem, index })}\n            >\n              <TagLabel>{selectedItem.label}</TagLabel>\n              <TagCloseButton\n                onClick={(e) => {\n                  e.stopPropagation()\n                  removeSelectedItem(selectedItem)\n                }}\n                aria-label='Remove menu selection badge'\n              />\n            </Tag>\n          ))}\n        </Stack>\n      )}\n      {/* ---------Stack with Selected Menu Tags above the Input Box--------- */}\n\n      {/* -----------Section that renders the input element ----------------- */}\n      <Stack isInline {...getComboboxProps()}>\n        <Input\n          {...inputStyleProps}\n          {...getInputProps(\n            getDropdownProps({\n              placeholder,\n              onClick: isOpen ? () => { } : openMenu,\n              onFocus: isOpen ? () => { } : openMenu,\n              ref: disclosureRef\n            })\n          )}\n        />\n        <Button\n          {...toggleButtonStyleProps}\n          {...getToggleButtonProps()}\n          aria-label='toggle menu'\n        >\n          {' '}\n          &#8595;{' '}\n        </Button>\n      </Stack>\n      {/* -----------Section that renders the input element ----------------- */}\n\n      {/* -----------Section that renders the Menu Lists Component ----------------- */}\n      <Box pb={4} mb={4}>\n        <List\n          bg='white'\n          borderRadius='4px'\n          border={isOpen && '1px solid rgba(0,0,0,0.1)'}\n          boxShadow='6px 5px 8px rgba(0,50,30,0.02)'\n          {...listStyleProps}\n          {...getMenuProps()}\n        >\n          {isOpen &&\n            inputItems.map((item, index) => (\n              <ListItem\n                px={2}\n                py={1}\n                borderBottom='1px solid rgba(0,0,0,0.01)'\n                {...listItemStyleProps}\n                bg={highlightedIndex === index ? highlightItemBg : 'inherit'}\n                key={`${item.value}${index}`}\n                {...getItemProps({ item, index })}\n              >\n                {isCreating ? (\n                  <Text>\n                    <Box as='span'>Create</Box>{' '}\n                    <Box as='span' bg='yellow.300' fontWeight='bold'>\n                      \"{item.label}\"\n                    </Box>\n                  </Text>\n                ) : (\n                    <Box display='inline-flex' alignItems='center'>\n                      {selectedItemValues.includes(item.value) && (\n                        <ListIcon\n                          as={icon || CheckCircleIcon}\n                          color='green.500'\n                          role='img'\n                          display='inline'\n                          aria-label='Selected'\n                          {...selectedIconProps}\n                        />\n                      )}\n\n                      {itemRenderer ? (\n                        itemRenderer(item)\n                      ) : (\n                          <Highlighter\n                            autoEscape\n                            searchWords={[inputValue || '']}\n                            textToHighlight={defaultItemRenderer(item)}\n                          />\n                        )}\n                    </Box>\n                  )}\n              </ListItem>\n            ))}\n        </List>\n      </Box>\n      {/* ----------- End Section that renders the Menu Lists Component ----------------- */}\n    </Stack>\n  )\n}\n"],"names":["defaultOptionFilterFunc","items","inputValue","matchSorter","keys","props","optionFilterFunc","itemRenderer","highlightItemBg","placeholder","label","listStyleProps","inputStyleProps","toggleButtonStyleProps","tagStyleProps","selectedIconProps","listItemStyleProps","onCreateItem","icon","downshiftProps","React","isCreating","setIsCreating","setInputValue","inputItems","setInputItems","disclosureRef","useMultipleSelection","getSelectedItemProps","getDropdownProps","addSelectedItem","removeSelectedItem","selectedItems","selectedItemValues","map","item","value","useCombobox","selectedItem","undefined","onInputValueChange","filteredItems","length","stateReducer","state","actionAndChanges","changes","type","stateChangeTypes","InputBlur","isOpen","InputKeyDownEnter","ItemClick","highlightedIndex","FunctionSelectItem","onStateChange","InputChange","includes","selectItem","getToggleButtonProps","getLabelProps","getMenuProps","getInputProps","getComboboxProps","getItemProps","openMenu","setHighlightedIndex","useDeepCompareEffect","Stack","FormLabel","spacing","isInline","flexWrap","index","Tag","mb","key","TagLabel","TagCloseButton","onClick","e","stopPropagation","Input","onFocus","ref","Button","Box","pb","List","bg","borderRadius","border","boxShadow","ListItem","px","py","borderBottom","Text","as","fontWeight","display","alignItems","ListIcon","CheckCircleIcon","color","role","Highlighter","autoEscape","searchWords","textToHighlight","selected"],"mappings":"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"}